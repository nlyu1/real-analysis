# Integration {#integration}

This section establishes the base case of the Lebesgue 
measure on $\R^n$: 

1. [Exterior measure](#extMeasure): foundational properties of the exterior 
    measure and interaction with rectangles. 
2. [Lebesgue measure and Borel regularity](#lebMeasure): 
    definition and relation with Borel sets, 
    characterization of measurable sets, example of a non-measurable set. 
3. [Measurable functions](#realMeasurableFunctions): .

Key takeaways: 

1. The exterior measure is the natural outer-measure extension of rectangle volume that 
    satisfies _monotonicity_, _countable subadditivity_, 
    and agrees with our initial definition. 
2. The Lebesgue measure is the CarathÃ©odory restriction of the exterior measure. 
3. Rectangles are measurable (proposition \@ref(prp:rectangleMeasurable)), 
        so Borel sets are measurable since they 
        are freely-generated by rectangles. 
4. The exterior measure (rectangle cover infimum) 
    is equivalent to open cover infimum, and on measurable sets equivalent 
    to compact subset supremum. 
5. A set is measurable iff 
    - it can be upper-approximated by an open cover 
    or lower-approximated by a closed subset up to arbitrarily small but 
    finite measure \@ref(thm:squeezeMeasurable). 
    - it can be approximated by a Borel set up 
    to zero measure \@ref(thm:borelApprox). 

## Measurable functions on $\R^n$ {#realMeasurableFunctions -}
:::{.proposition name="measurable function"}
Given a measurable space $(\Omega, \Sigma)$. A function 
$\Omega\to \R^n$ is $\Sigma$-measurable if 
$f^{-1}(B) \in \Sigma$ 
for every Borel set $B\subset \R^n$. 
:::

:::{.example}
If $\Sigma=\{\emptyset, \Omega\}$, then the only $\Sigma$-measurable 
functions from $\Omega\to \R^n$ are constant functions. On the 
other extreme, if $\Sigma=2^\Omega$, then every function is measurable. 
For a nontrivial example, if $\Sigma=\{\emptyset, (-\infty, 0), [0, \infty), \R\}$ 
then $f:\R\to \R$ is measurable iff it is 
constant on $(-\infty, 0), [0, \infty)$. 
:::

:::{.definition name="characteristic function"}
Given $E\subset \Omega$, the characteristic function $\chi_E:\Omega\to \R$ is 
\[ 
    \chi_E(x) = \begin{cases}
        1 & x\in E \\ 
        0 & x\notin E
    \end{cases}
\] 
:::

:::{.proposition name="property of characteristic function"}
Given $(\Omega, \Sigma), E\subset \Omega$, then $\chi_E$ is $\Sigma$-measurable 
iff $E\in \Sigma$. 
:::
_Proof:_ 
$\chi_E^{-1}(B) = \{E, \Omega-E, \Omega, \emptyset\}$ 
depending on how $B\subset \R$ intersects with $\{0, 1\}$. 

:::{.proposition name="continuity implies Borel measurability"}
Every continuous function $f:\Omega\to \R^n$ defined on 
a Borel subset $\Omega\subset \R^m$ is a Borel-measurable function. 
:::
_Proof:_ Consider the preimage of $x>a$ ($x, a\in \R^n$ and inequality 
holds elementwise). For any such $a$, consider 
\[ 
    f^{-1}(x>a) 
    = \left[\bigcup_{x\in f^{-1}(x>a)} (x-\delta_x, x+\delta_x) \right]\cap \Omega
\] 
Given every $x\in \R^m: f(x)>a$, by continuity $\exists \delta_x\in \R$ 
such that $f((x-\delta_x, x+\delta_x))>a$. The term in the paranthesis 
is an open set, hence its intersection with the Borel set $\Omega$ is Borel. 

$f:(\Omega\subset \R)\to \R$ is increasing if $x < y\implies f(x)\leq f(y)$; 
it is monotonic if $f$ or $-f$ is increasing. 

:::{.proposition}
if $f:\Omega\to \R$ is monotonic and $\Omega$ is Borel, then $f$ is measurable. 
:::
_Proof:_ Fix $a\in \R$, then for $b=\inf f^{-1}((a, \infty))$, 
monotonicity implies 
\[ 
    f^{-1}((a, \infty)) = (b, \infty)\cap \Omega 
    \text{ or }
    [b, \infty)\cap \Omega
\] 

:::{.proposition name="preservation of measurability under limits"}
Suppose $\{f_j\}\to f:(\Omega, \Sigma)\to \R^n$ point-wise each $f_j$ 
is $\Sigma$-measurable, then $f$ is $\Sigma$-measurable. 
:::
_Proof:_ Unrolling the definition of the limit: for any 
$x\in \Omega, a\in \R^n$, $f(x)>a$ iff 
\begin{align}
    & \lim_{k\to \infty} f_k(x) > a \\ 
    \iff & \exists j>0, \exists N: f_{\forall k>N}(x)>a+1/j \\ 
    \iff & x\in \bigcup_{j=1}^\infty 
        \bigcup_{N=1}^\infty 
        \bigcap_{k=1}^\infty f_k^{-1}(y>a+1/j)
\end{align}
Note that we only need some $j$ to exist. Each $\exists$ translates 
to $\bigcup$, and each $\forall$ translates to $\bigcap$. Then 
the preimage of $y>a$ the measurable set above. 

:::{.definition name="extended Borel"}
$A\subset [-\infty \infty]$ is a Borel set if $A\cap \R$ is Borel. 
Extended measurability is defined similarly. 
:::

:::{.theorem name="variational limits are measurable"}
Given measurable $\{f_k: (\Omega, \Sigma)\to \R\}$, the following functions 
are also measurable: 
\[ 
    g(x) = \inf_k f_k(x), \quad h(x) = \sup_k f_k(x)
\] 
:::
_Proof:_ It suffices to verify for the $\sup$ case that 
\begin{align}
    h(x) > a &\implies \exists k: f_k(x) > a \\ 
    h^{-1}((a, \infty]) &= \bigcup_{k=1}^\infty f_k^{-1}((a, \infty])
\end{align} 

:::{.proposition name="a.e. measurability"}
Given $f$ measurable and $f=g$ a.e. (they differ on a set of 
measure $0$ on the domain), then $g$ is measurable. 
:::
_Proof:_ Let $\{\mca A\}$ be a subbasis generating the measurable  
sets, then $\forall A\in \mca A$, the symmetric difference of 
pre-images $f^{-1}(A), g^{-1}(A)$ is dominated by a set of 
measure $0$; by measurability $g^{-1}(A)$ is measurable, 
so $f^{-1}(S)$ is also measurable. 

Some notations are convenient: 

:::{.definition #setSequenceNotation name="sequence of sets"}
An increasing sequence of sets $\{A_n\}$ is a sequence 
\[ 
    A_1\subset A_2\subset \cdots \to A = \bigcup_{n=1}^\infty A_n
\] 
also written $A_j\nearrow A$. Similarly, a decreasing 
sequence of sets is written $A_j\searrow A$. 
\[ 
    A_1\supset A_2\supset \cdots \to A = \bigcap_{n=1}^\infty A_n 
\] 
:::

## Simple functions {-}

:::{.definition name="simple function"}
A simple function is a finite sum 
\[ 
    f = \sum_{k=1}^N a_k \chi_{E_k} 
\] 
where each $E_k$ is a finite-measurable set. 
:::

The following proof is from Ch. 11 of [@rudin1964principles]. 

:::{.theorem #simpleFunctionApproximation name="simple-function approximation"}
Given a real function $f:\Omega\to \R$, there exists a sequence 
$\{s_n\}$ of simple functions such that $s_n(x)\to f(x)$ 
point-wise. If $f$ is measurable, then $\{s_n\}$ 
may be chosen to be a sequence of measurable functions. 
If $f\geq 0$, then $\{s_n\}$ may be chosen to be a monotonically 
increasing sequence. 
:::
_Proof:_ Given $f\geq 0$, define $F_n = f^{-1}([n, \infty))$ and 
\[ 
    E_{n, i} = f^{-1} \left(\left[2^{-n}(i-1), 2^{-n}i \right]\right)
\] 
For $n=1, 2, \cdots$ and $i=1, 2, \cdots, n2^n$, choose 
\[ 
    s_n = n\chi_{F_n} + \sum_{i=1}^{n2^n} \df{i-1}{2^n} \chi_{E_{n, i}}
\] 
Note that $E_{n, i}$ is the pre-image of the $i$-th slice of 
nonnegative real blocks of size $2^{-n}$, and the first term assigns 
$\inf f=2^{-n}(i-1)$ on the corresponding intervals. The second 
term just assigns approximates with $n$ all places where $f(x)\geq n$. 
The second term is reserved for cases where $f(x)=\infty$. In short: 

1. In the $n$-th approximation, approximate $f$ up to value $n$. 
2. Divide $f^{-1}([0, n])$ into $2^{-n}$ pieces and assign a dominated 
    simple function. Approximate the rest simply with $n$. 

If $f$ is measurable, the domains of the characteristic decomposition 
are measurable so $s_n$ is measurable. The general case follows by 
$f=f^+-f^-$. 

## Littlewood's three principles {-}

Littlewood's three principles are: 

1. Every finite-measurable set is almost a finite union of intervals. 
2. Every measurable function is almost continuous. 
3. Every pointwise convergent sequence of measurable functions 
    is almost uniformly convergent. 

To be precise, the third principle is formulated as follows: 

:::{.theorem name="Egorov's theorem"}
Given a a measurable sequence $(f_k)$ on a finite-measurable set 
$E$ with $\mu(E)<\infty$ such that $f_k\to f$ a.e. on $E$. 
For every $\epsilon>0$, there exists a closed set $A_\epsilon \subset E$ 
such that $\mu(E-A_\epsilon)<\epsilon$ and $f_k\to f$ uniformly 
on $A_\epsilon$ 
:::
_Proof:_ without loss of generality assume $f_k\to f$ pointwise (not just 
pointwise a.e.) since we only require $\mu(E-A_\epsilon)<\epsilon$; 
for each $n, k$, define 
\[ 
    E_k^n = \{x\in E: |f_{\forall j>k}(x) - f(x)|<1/n\}
\] 
In other words, this is the set on which $f_{j>k}$ is 
$1/n$-close to $f$ on $E$. Fix $n$. Note that 
$E^n_k\nearrow E$ by $f_k\to f$ (recall definition 
\@ref(def:setSequenceNotation)); then there exists $k_n$ 
such that 
\[ 
    \mu(E - E^n_{k_n}) < 2^{-n}, \quad 
    \sup_{x\in E^n_{k_n}} |f_j(x) - f(x)| < 1/n 
\] 
Choose $N$ so that $\sum_{n=N}^\infty 2^{-n}<\epsilon/2$ and let 
\[ 
    \tilde A_\epsilon = \bigcap_{n\geq N} E^n_{k_n}
\] 
This is domain subset on which, for each $n\geq N$, 
$|f_{j\geq k_n}(x) - f(x)| \leq 1/N$; also note that 
\[ 
    \mu(E - \tilde A_\epsilon) \leq \sum_{n=N}^\infty \mu(E - E^n_{k_n}) 
    < \epsilon/2 
\] 
Also note that $\tilde A_\epsilon$ is measurable since it is the 
intersection of $E^n_k$ which are pre-images; then by measurability 
characterization \@ref(thm:measurableCharacterization) there exists a 
closed $\epsilon/4$-coveree $A_\epsilon$ of $\tilde A_\epsilon$. 
Moreover, $f_k\to f$ uniformly on $A_\epsilon$ since for every 
$0<\epsilon'<1/n$, $|f_j(x)-f(x)|<\epsilon'$ when $j>k_n$ and 
$x\in E^n_{k_n} \supset A_\epsilon$. 

Similarly, the precise statement of the second principle is: 

:::{.theorem name="Lusin's theorem"}
Given measurable $f$ finite-valued on $E$ and $\mu(E)<\infty$, then 
for every $\epsilon>0$ there exists a closed $\epsilon$-coveree 
$F_\epsilon \subset E$ with $\mu(E-F_\epsilon)<\epsilon$ such that 
$f_{|F_\epsilon}$ is continuous in the subspace topology. 
:::
_Proof:_ <span style="color:red"> TODO </span>

<span style="color:green">
Lusin's theorem _does not claim_ that $f$ is continuous on $F_\epsilon$, 
only that $f_{|F_\epsilon}$ is continuous in the subspace topology. 
</span>

## Product measures, Fubini {-}

:::{.theorem #productMeasure name="characterization of product measure"}
Given two $\sigma$-finite measure spaces $(\Omega_1, \Sigma_1, \mu_1)$ and 
$(\Omega_2, \Sigma_2, \mu_2)$ define, for every measurable 
$A\in \Sigma_1\times \Sigma_2$: 

1. $f(y) = \mu_1(A_1(y)) = \mu_1(\{x\in \Omega_1: (x, y)\in A\})$. 
2. $g(x) = \mu_2(A_2(x)) = \mu_2(\{y\in \Omega_2: (x, y)\in A\})$. 

Then $f$ is $\Sigma_1$-measurable, $g$ is $\Sigma_2$-measurable, and 
\[ 
    (\mu_1\times \mu_2)(A) 
    = \int_{\Omega_2} f(y) d\mu_2 = \int_{\Omega_1} g(x) d\mu_1 
\] 
```{r echo=FALSE, fig.align='center', out.width='80%', fig.cap="Visual example. "}
  knitr::include_graphics("images/fubini.jpg") 
```
:::

To prove that $g$ is $\Sigma_1$-measurable, we prove that 
the set $\mca T$ of all subsets of $\R$ whose preimage is $\Sigma_1$-measurable 
generates the measurable sets on $\R$. 


:::{.proposition name="finiteness"}
The product $\Sigma_1\times \Sigma_2$ of 
two $\sigma$-finite measures is $\sigma$-finite. 
:::